<!DOCTYPE html>

<meta charset="utf-8">
<title>La délicate agilité du mammouth</title>

<section>
    <h2>La délicate agilité du mammouth</h2>
    <img class="displayed" src="mammoth.jpg" alt="mammoth" style="height:380px"/>
    <footer>Gregory Estrade @Torlus</footer>
</section>

<!--
Bonjour, je m'appelle Gregory Estrade, je viens de Toulouse, mais j'ai fait mes
études à Bordeaux, dans une école d'ingénieurs concurrente et je vais vous
présenter un retour d'expérience de mise en place de l'agilité dans l'entreprise
qui m'emploie.
-->

<section>
  <h2>Qui vous parle?</h2>
  <br />
  <img class="displayed" src="Torlus.jpg" alt="Torlus" style="height:220px"/>
  <br />
  <blockquote>
    Directeur de l'innovation à <strong>Lyra Network</strong>. Anciennement directeur du développement (50+ ingénieurs).
    Software engineer, hardware hacker.
  </blockquote>
  <footer>Gregory Estrade @Torlus</footer>
</section>

<!--
Lyra Network est un opérateur télécom qui connecte les terminaux de paiement par
carte, aux banques. On fait aussi plateforme de paiement e-commerce. Bref, notre
business model consiste à enrichir les banques, qui sont nos clients.
On est des sorte de Robin des Bois à l'envers: on prend aux pauvres pour donner
aux riches.

Alors les gens souvent me demandent "mais pourquoi tu as choisi de faire ça,
pas bien, mauvais karma, etc" et je leur réponds que j'ai pas vraiment choisi
cette carrière, mais bon malheureusement, j'ai été recalé au concours pour
devenir marchand d'armes.

J'y suis depuis 2003, j'étais le 5eme employé. Fast-forward 13 ans plus tard,
on est 200 en tout avec des filiales à l'international.
Du coup, au fil des ans, de développeur principal je me suis retrouvé
directeur du développement en charge d'une 50aine d'ingénieurs.
Je suis l'incarnation même du principe de Peter, j'ai été embauché
parce que je suis un super coder, et boum, me voilà propulsé au management.

J'ai occupé ce poste jusqu'en novembre dernier, où je suis passé à la direction
de l'innovation, qu'on avait décidé de créer. Du coup, je suis passé d'une
équipe de 50 à une équipe de un. C'est beaucoup plus relaxant.

L'innovation. j'en parlerai un peu à la fin, mais en gros, une des
caractéristiques c'est le droit à l'échec. Le "fail fast, fail often".
L'innovation sous forme lean startup interne, c'est sympa. Entrepreneur c'est
un métier super facile en fait, tu peux te planter 50 fois avant de réussir,
les gens s'en foutent, ils ne retiendrons que ce qui aura marché, vu que le
reste aura été tellement mauvais que personne ne l'utilise.

 C'est quand même le top, l'innovation. Avant j'étais payé pour réussir,
 maintenant je suis payé pour échouer. C'est génial, non?

 Nelson Mandela disait: "Je ne perds jamais. Soit je gagne, soit j'apprends".
 C'est une phrase qu'on va retrouver dans la bouche de beaucoup d'innovateurs.
 Et je dois vous avouer que pendant les 12 ans où j'ai occupé ce poste de
 directeur développemment, j'ai beaucoup, beaucoup, .... beaucoup appris.
-->


<section>
  <h2>Petit historique</h2>
  <h4>Agile Tour Toulouse 2015</h4>
  <img class="displayed" src="attls.png" alt="attls" style="height:300px"/>
</section>

<!--
Alors, la particularité de ce talk est qu'il a une petite histoire.
Je n'avais jamais auparavant donné de talk sur l'agilité, et les organisateurs
de l'Agile Tour Toulouse m'ont demandé: "mais pourquoi tu ne fais pas un retour
d'expérience"? J'ai dit OK, et bon je commence à rassembler des idées,
et j'étais parti pour faire un truc bien saignant, caustique, j'avais même
trouvé des formules un peu rigolotes, genre le "Fear Driven Development" ou
encore la "désintégration continue", bref ce genre de trucs.
Donc j'écris l'abstract que vous voyez là, j'en suis satisfait, par contre pour
le titre, aucune idée donc je colle "La délicate agilité du mammouth", en
attendant de trouver mieux.
-->

<section>
  <h2>Petit historique</h2>
  <h4>Agile Tour Toulouse 2015</h4>
  <img class="displayed" src="twitter_oaz.png" alt="twitter_oaz" style="height:400px"/>
</section>

<!-- Et là, mes chers amis de l'organisation de l'Agile Tour commencent à twitter,
à faire de la pub pour mon talk, comme ce que vous voyez là. Genre, c'est ma
première participation, ça met pas du tout la pression! Merci les gars...
-->

<section>
    <h2>La délicate agilité du mammouth</h2>
    <img class="displayed" src="mammoth.jpg" alt="mammoth" style="height:380px"/>
    <footer>Gregory Estrade @Torlus</footer>
</section>

<!--
Et donc, on arrive à une semaine de l'événement, je participe à une réunion de
préparation, et là je dis "bon, je vois à peu près de quoi je vais parler, mais
voilà, dans le descriptif, le titre ne me plait pas, je vais trouver autre chose".
Ils me regardent avec des yeux ronds, et me disent "t'es fou, ton titre il est
génial, on a communiqué dessus, etc. Et en gros tu fais ce que tu veux, mais ton
titre, tu le gardes!"

Donc me voilà bien emmerdé, et puis je réfléchis un peu et je me dit que bon,
on est agile, ou on l'est pas? Et donc, ne pouvant pas changer le titre, j'ai
donc décidé de changer le contenu!
-->

<section>
  <h2>La délicate agilité du mammouth</h2>
  <h3>Un retour d'expérience sous forme de documentaire animalier.</h3>
</section>

<!--
Et donc, ça donne ceci: Un retour d'expérience de la mise en place de l'agilité
sous forme d'un documentaire animalier.

Bon il faut savoir que ce n'est pas moi qui ai souhaité le passage des projets
"en agile" (faire les guillemets avec les doigts), c'est à la demande des
développeurs, que ça a commencé. Moi, je suis un partisan du "laisser faire",
de faire confiance aux gens, donc on y va.

L'agilité, j'y connais rien, je sais juste que ça met en jeu des post-its, et
ça, ça me va bien. Au début de ma carrière, dans les années 90, pour faire du
code propre il fallait des outils genre Rational Rose, avec le RUP (Rational
Unified Process) et là c'était pas évident de vendre ça à sa direction.
Parce que bon, de mémoire, les licences chiffraient vite à des dixaines de
milliers de Francs, à l'époque.

Là c'est super, tout est masqué une petite augmentation du budget fournitures,
et il faut simplement faire passer le mot à la femme de ménage que oui les
post-its partout c'est normal, que c'est gentil de tous les avoir décollés,
mais qu'il ne faut à l'avenir ne surtout pas y toucher, etc.

Et puis pour un directeur comme moi, l'agilité c'est simple à comprendre avec
ces post-its: tu vas dans le bureau de tel ou tel projet, tu vois où tu en es
avec tes dealines et en gros, si les post-its sont plutôt tassés à droite,
c'est qu'on est dans les clous, et que par contre si les post-its sont plutôt
rassemblés sur la gauche, c'est que ça ne se passe pas bien. Facile!
-->

<section>
  <h2>Infinite Monkey Theorem</h2>
  <blockquote>
    Given an infinite length of time, a chimpanzee punching at random on a typewriter would almost surely type out all of Shakespeare's plays.
  </blockquote>
  <img class="displayed" src="monkey-typing.jpg" alt="monkey-typing" />
</section>

<!--
Donc allez, on s'y colle, on prend machin qui a été SCRUM Master dans une vie
antérieure, on prend bidule qui a fait du Kanban dans son job précédent, on
touille un peu tout ça et... bin c'est pas la fête.

Et donc j'ai l'impression d'être dans cette situation, et que ce n'est pas en
rajoutant des singes que ça va s'arranger. Alors là, je vous arrête tout de
suite, je n'ai jamais voulu comparer mes développeurs à des singes!
Ca ne serait pas très sympa de ma part. Malheureusement dans ce qui va suivre
il y a des comparaisons bien pires.

Donc bref, je me dis qu'il faudrait que moi, en tant que manager, je fasse
quelque chose. Donc, comme dit en général tout bon entraineur de rugby lorsque
son équipe vient de se prendre une branlée monumentale, et qu'on lui tend le
micro: "Il faut se recentrer sur nos fondamentaux".

Donc c'est parti, on reprend tout depuis le début, on retourne aux sources
de l'agilité.
-->

<section>
  <blockquote>
    Build projects around motivated individuals.
  </blockquote>
  <br />
  <img class="displayed" src="chicken-pig.jpg" alt="chicken-pig" height="330"/>
  <blockquote>
    Question: In a bacon-and-egg breakfast, what's the difference between the Chicken and the Pig?
    <br />
    Answer:<em> The Chicken is involved, but the Pig is committed!</em>
  </blockquote>
</section>

<!--
Bon vous connaissez tous l'image de la poule et du cochon qui vont contribuer à
un "english breakfast" (explication).
Bon déjà, je me dis qu'on est un peu dans la fumisterie, parce que comme pré-requis,
c'est lourd. Je vois des coachs agiles aller faire des missions à droite à gauche
dans des grands groupes ou des entreprises mi-privées mi-publiques. Déjà eux,
ils partent mal. Bon heureusement à Lyra, on est pas concernés par ce problème.
-->

<section>
  <blockquote>
    Our highest priority is to satisfy the customer
    through early and continuous delivery
    of valuable software.
  </blockquote>
  <img class="displayed" src="3monkeys.png" alt="3monkeys" height="350" />
  <h2>Customer ?</h2>
</section>

<!--
Nous y voilà! Le fameux "client". Ceux qui l'ont vu et entendu ne diront rien,
ceux qui l'ont vu ne l'aurons pas entendu et ainsi de suite.

En général, c'est la situation où la plupart des entreprises et des projets se
placent, du fait de l'organisation sous forme de "silos" qui empêchent la
communication en direct, du développeur à l'utilisateur.

Et pourtant dans les moyens qu'il faut mettre en oeuvre pour être agile, il y
a ceci:
-->

<section>
  <blockquote>
    Business people and developers must work together daily throughout the project.
  </blockquote>
  <img class="displayed" src="5legs.png" alt="five legs" height="350"/>
  <blockquote>
Agile developers adopt practices such as on-site customer and active stakeholder participation, and adopt inclusive tools and techniques which enable stakeholders to be actively involved with software development.
  </blockquote>
</section>

<!--
C'est là en général que ça coince. Parce que pour être agile, il faut que TOUT LE
MONDE participe. Les développeurs mais aussi les commerciaux, la MOA, etc.

Et au bout de la chaine, il y a le client, ou plutôt le "client du client", c'est
à dire l'utilisateur final.

Et le problème c'est que les obstacles sont nombreux. Par exemple, le client qui
croit que bosser en agile, c'est filer un cahier des charges flou (bah oui, flou
c'est plus facile, et puis avec l'agilité de toute façon, on peut tout changer en
cours de route pour le même prix, c'est fait pour).
A la première collecte de feedback, il est surpris, il y participe parce qu'il
veut voir, et là on lui fait valider un tout petit bout de ce qu'il a demandé.
Et là, c'est le drame, il ne comprend pas pourquoi on lui prend son temps pour
ça et bientôt, il va nous dire: "bon, on se voit dans un an quand vous aurez
fini, ok?"
Et là, vous pouvez utiliser tout ce que vous voulez dans l'outillage de
l'agilité, ça aura le goût de l'agile, la couleur de l'agile, l'odeur de l'agile
mais ça ne sera pas de l'agile.
J'aime bien le terme VRUM pour décrire cette situation. Un fond d'agilité noyé
au beau milieu d'un bon gros cycle en V.

Et là, j'ai parlé du client, pas de l'utilisateur final. Lui, avant de le
trouver, il va falloir se lever de bonne heure.

Alors en général, et bien, on fait avec, on invente ce qu'on ne sait pas et on
entend de plus en plus la phrase fatidique: "Alors moi, je me mets à la place
du client, et..." STOP. N'allez pas plus loin. On va procéder à un petit exercice
d'amélioration de produit.
-->

<section>
  <h2>Etude de cas</h2>
  <h4>Amélioration d'un produit existant</h4>
  <ul class="incremental">
    <li><span class="ii">Vous <img style="vertical-align: middle; height:120px" src="human.png" alt="human" /></span></li>
    <li><span class="ii">Votre client <img style="vertical-align: middle; height:120px" src="monkey.jpg" alt="monkey" /></span></li>
    <li><span class="ii">Votre produit <img style="vertical-align: middle; height:80px" src="banana.png" alt="banana" /></span></li>
  </ul>
</section>

<!--
TODO
-->

<section>
  <h2>Vision produit - Vous</h2>
  <br />
  <img class="displayed" src="banana-h.png" alt="banana" style="height:400px"/>
</section>

<!--
TODO
-->

<section>
  <h2>Vision produit - Client</h2>
  <br />
  <img class="displayed" src="banana-m.png" alt="banana" style="height:400px"/>
</section>

<!--
TODO
-->

<section>
  <img class="displayed" src="instructables.png" alt="instructables" style="height:600px"/>
</section>

<!--
TODO
-->

<section>
  <img class="displayed" src="housemd.jpg" alt="housemd" height="300" />
  <img class="displayed" src="wolf.jpg" alt="wolf" height="300" />
</section>

<!--

-->

<section>
  <h2>Un comportement à adopter?</h2>
  <br />
  <img class="displayed" src="chameleon.jpg" alt="chameleon" height="300"/>
  <br />
  <blockquote>
    S'adapter à son environnement, observer plutôt que (mal) faire.
    Etre un client agile, avant d'être un partenaire agile.
  </blockquote>
</section>

<section>
  <h1>L'agilité dans la durée</h1>
</section>

<section>
  <h2>La nature humaine</h2>
  <img class="displayed" src="scorpion.jpg" alt="scorpion" height="230"/>
  <br />
  <img class="displayed" src="croco.jpg" alt="croco" height="200"/>
</section>

<section>
  <h2>Importance du langage</h2>
    <h4>Un collaborateur.</h4>
    <h4>Une ressource.</h4>
    <h4>Un ETP.</h4>
    <img class="displayed" src="hyena.jpg" alt="hyena" height="190"/>
    <br />
    <blockquote>
Les projets passent, les personnes restent (ou pas).
    </blockquote>
</section>

<section>
  <h2>Devinette - l'ETP idéal</h2>
  <span class="incremental"><img class="displayed" src="oursin.png" alt="oursin" height="200"/></span>
  <blockquote>
L'animal ne présente pas de faces « ventrale » et « dorsale » ... Il n'a donc pas non plus de tête...
<br />
L'animal n'a ni « avant » ni « arrière », et donc pas de sens de progression préférentiel.
<br />
Ces animaux n'ont généralement aucun dimorphisme sexuel : mâles et femelles sont absolument semblables visuellement, et des cas d'hermaphrodisme semblent exister.
  </blockquote>

</section>


<section>
  <h2>Responsabilité managériale</h2>
  <ul>
    <li><span class="ii">Leader<img style="vertical-align: middle; height:180px" src="sheep.png" alt="sheep" /></span></li>
    <li><span class="ii">Manage<img style="vertical-align: middle; height:180px" src="mante.jpg" alt="mante" /></span></li>
  </ul>
  <blockquote>
    Posture et savoir-être. "Protéger du crime". Innovation.
  </blockquote>
</section>

<section>
    <h1>Merci !</h1>
    <footer>Gregory Estrade @Torlus</footer>
</section>


<!-- Your Style -->
<!-- Define the style of your presentation -->

<!-- Maybe a font from http://www.google.com/webfonts ? -->
<link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet'>

<style>
  html, .view body { background-color: black; counter-reset: slideidx; }
  body, .view section { background-color: white; border-radius: 12px }
  /* A section is a slide. It's size is 800x600, and this will never change */
  section, .view head > title {
      /* The font from Google */
      font-family: 'Oswald', arial, serif;
      font-size: 30px;
  }

  .view section:after {
    counter-increment: slideidx;
    content: counter(slideidx, decimal-leading-zero);
    position: absolute; bottom: -80px; right: 100px;
    color: white;
  }

  .view head > title {
    color: white;
    text-align: center;
    margin: 1em 0 1em 0;
  }

  h1 {
    margin-top: 200px;
    text-align: center;
    font-size: 80px;
  }
  h2 {
    margin-top: 20px;
    text-align: center;
    font-size: 60px;
  }
  h3 {
    text-align: center;
    font-size: 50px;
    margin-top: 150px;
    /* margin: 100px 0 50px 100px; */
  }
  h4 {
    text-align: center;
    font-size: 40px;
    color: #333;
  }

  ul {
      margin: 20px 200px;
  }
  li > ul {
      margin: 15px 50px;
  }

  p {
    margin: 75px;
    font-size: 40px;
  }

  blockquote {
    /* height: 100%; */
    background-color: #333;
    color: white;
    font-size: 25px;
    padding: 20px;
  }
  /*blockquote:before {
    content: open-quote;
  }
  blockquote:after {
    content: close-quote;
  }*/

  span.ii {
    display: block;
    margin-top: 10px;
    margin-bottom: 10px;
  }

  img.displayed {
    display: block;
    margin-left: auto;
    margin-right: auto;
  }
  /* Figures are displayed full-page, with the caption
     on top of the image/video */
  figure {
    background-color: black;
    width: 100%;
    height: 100%;
  }
  figure > * {
    position: absolute;
  }
  figure > img, figure > video {
    width: 100%; height: 100%;
  }
  figcaption {
    margin: 70px;
    font-size: 50px;
  }

  footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    padding: 10px;
    text-align: right;
    background-color: #F3F4F8;
    border-top: 1px solid #CCC;
  }

  /* Transition effect */
  /* Feel free to change the transition effect for original
     animations. See here:
     https://developer.mozilla.org/en/CSS/CSS_transitions
     How to use CSS3 Transitions: */
  section {
    -moz-transition: left 400ms linear 0s;
    -webkit-transition: left 400ms linear 0s;
    -ms-transition: left 400ms linear 0s;
    transition: left 400ms linear 0s;
  }
  .view section {
    -moz-transition: none;
    -webkit-transition: none;
    -ms-transition: none;
    transition: none;
  }

  .view section[aria-selected] {
    border: 5px red solid;
  }

  /* Before */
  section { left: -150%; }
  /* Now */
  section[aria-selected] { left: 0; }
  /* After */
  section[aria-selected] ~ section { left: +150%; }

  /* Incremental elements */

  /* By default, visible */
  .incremental > * { opacity: 1; }

  /* The current item */
  .incremental > *[aria-selected] { opacity: 1; }

  /* The items to-be-selected */
  .incremental > *[aria-selected] ~ * { opacity: 0; }

  /* The progressbar, at the bottom of the slides, show the global
     progress of the presentation. */
  #progress-bar {
    height: 2px;
    background: #AAA;
  }
</style>

<!-- {{{{ dzslides core
#
#
#     __  __  __       .  __   ___  __
#    |  \  / /__` |    | |  \ |__  /__`
#    |__/ /_ .__/ |___ | |__/ |___ .__/ core :€
#
#
# The following block of code is not supposed to be edited.
# But if you want to change the behavior of these slides,
# feel free to hack it!
#
-->

<div id="progress-bar"></div>

<!-- Default Style -->
<style>
  * { margin: 0; padding: 0; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
  [role="note"] { display: none; }
  body {
    width: 800px; height: 600px;
    margin-left: -400px; margin-top: -300px;
    position: absolute; top: 50%; left: 50%;
    overflow: hidden;
    display: none;
  }
  .view body {
    position: static;
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    display: inline-block;
    overflow: visible; overflow-x: hidden;
    /* undo Dz.onresize */
    transform: none !important;
    -moz-transform: none !important;
    -webkit-transform: none !important;
    -o-transform: none !important;
    -ms-transform: none !important;
  }
  .view head, .view head > title { display: block }
  section {
    position: absolute;
    pointer-events: none;
    width: 100%; height: 100%;
  }
  .view section {
    pointer-events: auto;
    position: static;
    width: 800px; height: 600px;
    margin: -150px -200px;
    float: left;

    transform: scale(.4);
    -moz-transform: scale(.4);
    -webkit-transform: scale(.4);
    -o-transform: scale(.4);
    -ms-transform: scale(.4);
  }
  .view section > * { pointer-events: none; }
  section[aria-selected] { pointer-events: auto; }
  html { overflow: hidden; }
  html.view { overflow: visible; }
  body.loaded { display: block; }
  .incremental {visibility: hidden; }
  .incremental[active] {visibility: visible; }
  #progress-bar{
    bottom: 0;
    position: absolute;
    -moz-transition: width 400ms linear 0s;
    -webkit-transition: width 400ms linear 0s;
    -ms-transition: width 400ms linear 0s;
    transition: width 400ms linear 0s;
  }
  .view #progress-bar {
    display: none;
  }
</style>

<script>
  var Dz = {
    remoteWindows: [],
    idx: -1,
    step: 0,
    html: null,
    slides: null,
    progressBar : null,
    params: {
      autoplay: "1"
    }
  };

  Dz.init = function() {
    document.body.className = "loaded";
    this.slides = Array.prototype.slice.call($$("body > section"));
    this.progressBar = $("#progress-bar");
    this.html = document.body.parentNode;
    this.setupParams();
    this.onhashchange();
    this.setupTouchEvents();
    this.onresize();
    this.setupView();
  }

  Dz.setupParams = function() {
    var p = window.location.search.substr(1).split('&');
    p.forEach(function(e, i, a) {
      var keyVal = e.split('=');
      Dz.params[keyVal[0]] = decodeURIComponent(keyVal[1]);
    });
  // Specific params handling
    if (!+this.params.autoplay)
      $$.forEach($$("video"), function(v){ v.controls = true });
  }

  Dz.onkeydown = function(aEvent) {
    // Don't intercept keyboard shortcuts
    if (aEvent.altKey
      || aEvent.ctrlKey
      || aEvent.metaKey
      || aEvent.shiftKey) {
      return;
    }
    if ( aEvent.keyCode == 37 // left arrow
      || aEvent.keyCode == 38 // up arrow
      || aEvent.keyCode == 33 // page up
    ) {
      aEvent.preventDefault();
      this.back();
    }
    if ( aEvent.keyCode == 39 // right arrow
      || aEvent.keyCode == 40 // down arrow
      || aEvent.keyCode == 34 // page down
    ) {
      aEvent.preventDefault();
      this.forward();
    }
    if (aEvent.keyCode == 35) { // end
      aEvent.preventDefault();
      this.goEnd();
    }
    if (aEvent.keyCode == 36) { // home
      aEvent.preventDefault();
      this.goStart();
    }
    if (aEvent.keyCode == 32) { // space
      aEvent.preventDefault();
      this.toggleContent();
    }
    if (aEvent.keyCode == 70) { // f
      aEvent.preventDefault();
      this.goFullscreen();
    }
    if (aEvent.keyCode == 79) { // o
      aEvent.preventDefault();
      this.toggleView();
    }
  }

  /* Touch Events */

  Dz.setupTouchEvents = function() {
    var orgX, newX;
    var tracking = false;

    var db = document.body;
    db.addEventListener("touchstart", start.bind(this), false);
    db.addEventListener("touchmove", move.bind(this), false);

    function start(aEvent) {
      aEvent.preventDefault();
      tracking = true;
      orgX = aEvent.changedTouches[0].pageX;
    }

    function move(aEvent) {
      if (!tracking) return;
      newX = aEvent.changedTouches[0].pageX;
      if (orgX - newX > 100) {
        tracking = false;
        this.forward();
      } else {
        if (orgX - newX < -100) {
          tracking = false;
          this.back();
        }
      }
    }
  }

  Dz.setupView = function() {
    document.body.addEventListener("click", function ( e ) {
      if (!Dz.html.classList.contains("view")) return;
      if (!e.target || e.target.nodeName != "SECTION") return;

      Dz.html.classList.remove("view");
      Dz.setCursor(Dz.slides.indexOf(e.target) + 1);
    }, false);
  }

  /* Adapt the size of the slides to the window */

  Dz.onresize = function() {
    var db = document.body;
    var sx = db.clientWidth / window.innerWidth;
    var sy = db.clientHeight / window.innerHeight;
    var transform = "scale(" + (1/Math.max(sx, sy)) + ")";

    db.style.MozTransform = transform;
    db.style.WebkitTransform = transform;
    db.style.OTransform = transform;
    db.style.msTransform = transform;
    db.style.transform = transform;
  }


  Dz.getNotes = function(aIdx) {
    var s = $("section:nth-of-type(" + aIdx + ")");
    var d = s.$("[role='note']");
    return d ? d.innerHTML : "";
  }

  Dz.onmessage = function(aEvent) {
    var argv = aEvent.data.split(" "), argc = argv.length;
    argv.forEach(function(e, i, a) { a[i] = decodeURIComponent(e) });
    var win = aEvent.source;
    if (argv[0] === "REGISTER" && argc === 1) {
      this.remoteWindows.push(win);
      this.postMsg(win, "REGISTERED", document.title, this.slides.length);
      this.postMsg(win, "CURSOR", this.idx + "." + this.step);
      return;
    }
    if (argv[0] === "BACK" && argc === 1)
      this.back();
    if (argv[0] === "FORWARD" && argc === 1)
      this.forward();
    if (argv[0] === "START" && argc === 1)
      this.goStart();
    if (argv[0] === "END" && argc === 1)
      this.goEnd();
    if (argv[0] === "TOGGLE_CONTENT" && argc === 1)
      this.toggleContent();
    if (argv[0] === "SET_CURSOR" && argc === 2)
      window.location.hash = "#" + argv[1];
    if (argv[0] === "GET_CURSOR" && argc === 1)
      this.postMsg(win, "CURSOR", this.idx + "." + this.step);
    if (argv[0] === "GET_NOTES" && argc === 1)
      this.postMsg(win, "NOTES", this.getNotes(this.idx));
  }

  Dz.toggleContent = function() {
    // If a Video is present in this new slide, play it.
    // If a Video is present in the previous slide, stop it.
    var s = $("section[aria-selected]");
    if (s) {
      var video = s.$("video");
      if (video) {
        if (video.ended || video.paused) {
          video.play();
        } else {
          video.pause();
        }
      }
    }
  }

  Dz.setCursor = function(aIdx, aStep) {
    // If the user change the slide number in the URL bar, jump
    // to this slide.
    aStep = (aStep != 0 && typeof aStep !== "undefined") ? "." + aStep : ".0";
    window.location.hash = "#" + aIdx + aStep;
  }

  Dz.onhashchange = function() {
    var cursor = window.location.hash.split("#"),
        newidx = 1,
        newstep = 0;
    if (cursor.length == 2) {
      newidx = ~~cursor[1].split(".")[0];
      newstep = ~~cursor[1].split(".")[1];
      if (newstep > Dz.slides[newidx - 1].$$('.incremental > *').length) {
        newstep = 0;
        newidx++;
      }
    }
    this.setProgress(newidx, newstep);
    if (newidx != this.idx) {
      this.setSlide(newidx);
    }
    if (newstep != this.step) {
      this.setIncremental(newstep);
    }
    for (var i = 0; i < this.remoteWindows.length; i++) {
      this.postMsg(this.remoteWindows[i], "CURSOR", this.idx + "." + this.step);
    }
  }

  Dz.back = function() {
    if (this.idx == 1 && this.step == 0) {
      return;
    }
    if (this.step == 0) {
      this.setCursor(this.idx - 1,
                     this.slides[this.idx - 2].$$('.incremental > *').length);
    } else {
      this.setCursor(this.idx, this.step - 1);
    }
  }

  Dz.forward = function() {
    if (this.idx >= this.slides.length &&
        this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
        return;
    }
    if (this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
      this.setCursor(this.idx + 1, 0);
    } else {
      this.setCursor(this.idx, this.step + 1);
    }
  }

  Dz.goStart = function() {
    this.setCursor(1, 0);
  }

  Dz.goEnd = function() {
    var lastIdx = this.slides.length;
    var lastStep = this.slides[lastIdx - 1].$$('.incremental > *').length;
    this.setCursor(lastIdx, lastStep);
  }

  Dz.toggleView = function() {
    this.html.classList.toggle("view");

    if (this.html.classList.contains("view")) {
      $("section[aria-selected]").scrollIntoView(true);
    }
  }

  Dz.setSlide = function(aIdx) {
    this.idx = aIdx;
    var old = $("section[aria-selected]");
    var next = $("section:nth-of-type("+ this.idx +")");
    if (old) {
      old.removeAttribute("aria-selected");
      var video = old.$("video");
      if (video) {
        video.pause();
      }
    }
    if (next) {
      next.setAttribute("aria-selected", "true");
      if (this.html.classList.contains("view")) {
        next.scrollIntoView();
      }
      var video = next.$("video");
      if (video && !!+this.params.autoplay) {
        video.play();
      }
    } else {
      // That should not happen
      this.idx = -1;
      // console.warn("Slide doesn't exist.");
    }
  }

  Dz.setIncremental = function(aStep) {
    this.step = aStep;
    var old = this.slides[this.idx - 1].$('.incremental > *[aria-selected]');
    if (old) {
      old.removeAttribute('aria-selected');
    }
    var incrementals = $$('.incremental');
    if (this.step <= 0) {
      $$.forEach(incrementals, function(aNode) {
        aNode.removeAttribute('active');
      });
      return;
    }
    var next = this.slides[this.idx - 1].$$('.incremental > *')[this.step - 1];
    if (next) {
      next.setAttribute('aria-selected', true);
      next.parentNode.setAttribute('active', true);
      var found = false;
      $$.forEach(incrementals, function(aNode) {
        if (aNode != next.parentNode)
          if (found)
            aNode.removeAttribute('active');
          else
            aNode.setAttribute('active', true);
        else
          found = true;
      });
    } else {
      setCursor(this.idx, 0);
    }
    return next;
  }

  Dz.goFullscreen = function() {
    var html = $('html'),
        requestFullscreen = html.requestFullscreen || html.requestFullScreen || html.mozRequestFullScreen || html.webkitRequestFullScreen;
    if (requestFullscreen) {
      requestFullscreen.apply(html);
    }
  }

  Dz.setProgress = function(aIdx, aStep) {
    var slide = $("section:nth-of-type("+ aIdx +")");
    if (!slide)
      return;
    var steps = slide.$$('.incremental > *').length + 1,
        slideSize = 100 / (this.slides.length - 1),
        stepSize = slideSize / steps;
    this.progressBar.style.width = ((aIdx - 1) * slideSize + aStep * stepSize) + '%';
  }

  Dz.postMsg = function(aWin, aMsg) { // [arg0, [arg1...]]
    aMsg = [aMsg];
    for (var i = 2; i < arguments.length; i++)
      aMsg.push(encodeURIComponent(arguments[i]));
    aWin.postMessage(aMsg.join(" "), "*");
  }

  function init() {
    Dz.init();
    window.onkeydown = Dz.onkeydown.bind(Dz);
    window.onresize = Dz.onresize.bind(Dz);
    window.onhashchange = Dz.onhashchange.bind(Dz);
    window.onmessage = Dz.onmessage.bind(Dz);
  }

  window.onload = init;
</script>


<script> // Helpers
  if (!Function.prototype.bind) {
    Function.prototype.bind = function (oThis) {

      // closest thing possible to the ECMAScript 5 internal IsCallable
      // function
      if (typeof this !== "function")
      throw new TypeError(
        "Function.prototype.bind - what is trying to be fBound is not callable"
      );

      var aArgs = Array.prototype.slice.call(arguments, 1),
          fToBind = this,
          fNOP = function () {},
          fBound = function () {
            return fToBind.apply( this instanceof fNOP ? this : oThis || window,
                   aArgs.concat(Array.prototype.slice.call(arguments)));
          };

      fNOP.prototype = this.prototype;
      fBound.prototype = new fNOP();

      return fBound;
    };
  }

  var $ = (HTMLElement.prototype.$ = function(aQuery) {
    return this.querySelector(aQuery);
  }).bind(document);

  var $$ = (HTMLElement.prototype.$$ = function(aQuery) {
    return this.querySelectorAll(aQuery);
  }).bind(document);

  $$.forEach = function(nodeList, fun) {
    Array.prototype.forEach.call(nodeList, fun);
  }

</script>
<!-- vim: set fdm=marker: }}} -->
